

-- Proper Spirit Guide spawns.
-- Test.

DELETE FROM creature WHERE id IN(31841, 31842);
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `phaseMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`, `npcflag`, `unit_flags`, `dynamicflags`) VALUES (88314, 31841, 571, 1, 64, 0, 1, 5537.48, 2898.91, 517.259, 4.86947, 120, 0, 0, 1, 0, 0, 0, 0, 0);
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `phaseMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`, `npcflag`, `unit_flags`, `dynamicflags`) VALUES (88312, 31841, 571, 1, 16, 0, 1, 5104.75, 2300.95, 368.568, 0.733038, 120, 0, 0, 1, 0, 0, 0, 0, 0);
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `phaseMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`, `npcflag`, `unit_flags`, `dynamicflags`) VALUES (88315, 31841, 571, 1, 1, 0, 1, 5031.84, 3710.75, 372.483, 3.3827, 120, 0, 0, 1, 0, 0, 0, 0, 0);
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `phaseMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`, `npcflag`, `unit_flags`, `dynamicflags`) VALUES (88313, 31841, 571, 1, 64, 0, 1, 5103.13, 3462.13, 368.568, 5.2709, 120, 0, 0, 1, 0, 0, 0, 0, 0);
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `phaseMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`, `npcflag`, `unit_flags`, `dynamicflags`) VALUES (88311, 31841, 571, 1, 16, 0, 1, 4336.25, 3235.52, 390.334, 0.628319, 120, 0, 0, 1, 0, 0, 0, 0, 0);
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `phaseMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`, `npcflag`, `unit_flags`, `dynamicflags`) VALUES (88310, 31841, 571, 1, 16, 0, 1, 4318.44, 2408.07, 392.676, 6.23083, 120, 0, 0, 1, 0, 0, 0, 0, 0);
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `phaseMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`, `npcflag`, `unit_flags`, `dynamicflags`) VALUES (88317, 31842, 571, 1, 32, 0, 1, 4336.25, 3235.52, 390.334, 0.628319, 120, 0, 0, 1, 0, 0, 0, 0, 0);
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `phaseMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`, `npcflag`, `unit_flags`, `dynamicflags`) VALUES (88320, 31842, 571, 1, 128, 0, 1, 5537.48, 2898.91, 517.259, 4.86947, 120, 0, 0, 1, 0, 0, 0, 0, 0);
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `phaseMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`, `npcflag`, `unit_flags`, `dynamicflags`) VALUES (88319, 31842, 571, 1, 129, 0, 1, 5103.13, 3462.13, 368.568, 5.2709, 120, 0, 0, 1, 0, 0, 0, 0, 0);
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `phaseMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`, `npcflag`, `unit_flags`, `dynamicflags`) VALUES (88318, 31842, 571, 1, 32, 0, 1, 5104.75, 2300.95, 368.568, 0.733038, 120, 0, 0, 1, 0, 0, 0, 0, 0);
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `phaseMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`, `npcflag`, `unit_flags`, `dynamicflags`) VALUES (88321, 31842, 571, 1, 1, 0, 1, 5140.79, 2179.12, 390.951, 1.97222, 120, 0, 0, 1, 0, 0, 0, 0, 0);
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `phaseMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`, `npcflag`, `unit_flags`, `dynamicflags`) VALUES (88316, 31842, 571, 1, 32, 0, 1, 4318.44, 2408.07, 392.676, 6.23083, 120, 0, 0, 1, 0, 0, 0, 0, 0);





-- Dalaran Portals with the proper spells.
DELETE FROM gameobject_template WHERE entry IN (305205, 305206);
INSERT INTO `gameobject_template` (`entry`, `type`, `displayId`, `name`, `IconName`, `castBarCaption`, `unk1`, `faction`, `flags`, `size`, `questItem1`, `questItem2`, `questItem3`, `questItem4`, `questItem5`, `questItem6`, `data0`, `data1`, `data2`, `data3`, `data4`, `data5`, `data6`, `data7`, `data8`, `data9`, `data10`, `data11`, `data12`, `data13`, `data14`, `data15`, `data16`, `data17`, `data18`, `data19`, `data20`, `data21`, `data22`, `data23`, `AIName`, `ScriptName`, `VerifiedBuild`) VALUES 
(305205, 22, 8506, 'Portal to Wintergrasp', '', '', '', 35, 0, 1, 0, 0, 0, 0, 0, 0, 58632, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, '', '', 12340),
(305206, 22, 8506, 'Portal to Wintergrasp', '', '', '', 35, 0, 1, 0, 0, 0, 0, 0, 0, 58633, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, '', '', 12340);


-- Spells
DELETE FROM spell_target_position WHERE id IN(58632, 58633);
INSERT INTO `spell_target_position` (`id`, `effIndex`, `target_map`, `target_position_x`, `target_position_y`, `target_position_z`, `target_orientation`, `VerifiedBuild`) VALUES 
(58632, 0, 571, 5100.49, 2181.34, 365.63, 2.77, 0),
(58633, 0, 571, 5026.01, 3676.98, 362.61, 4.254, 0)
;

-- Siege engine correction - for both alliance and horde.
DELETE FROM conditions where sourcegroup IN(28312, 32627);
INSERT INTO `conditions` (`SourceTypeOrReferenceId`, `SourceGroup`, `SourceEntry`, `SourceId`, `ElseGroup`, `ConditionTypeOrReference`, `ConditionTarget`, `ConditionValue1`, `ConditionValue2`, `ConditionValue3`, `NegativeCondition`, `ErrorType`, `ErrorTextId`, `ScriptName`, `Comment`) VALUES (18, 28312, 60968, 0, 0, 31, 0, 4, 0, 0, 0, 0, 0, '', 'Require player for spellclick');
INSERT INTO `conditions` (`SourceTypeOrReferenceId`, `SourceGroup`, `SourceEntry`, `SourceId`, `ElseGroup`, `ConditionTypeOrReference`, `ConditionTarget`, `ConditionValue1`, `ConditionValue2`, `ConditionValue3`, `NegativeCondition`, `ErrorType`, `ErrorTextId`, `ScriptName`, `Comment`) VALUES (18, 28312, 46598, 0, 0, 31, 0, 3, 0, 0, 0, 0, 0, '', 'Require unit for spellclick');
INSERT INTO `conditions` (`SourceTypeOrReferenceId`, `SourceGroup`, `SourceEntry`, `SourceId`, `ElseGroup`, `ConditionTypeOrReference`, `ConditionTarget`, `ConditionValue1`, `ConditionValue2`, `ConditionValue3`, `NegativeCondition`, `ErrorType`, `ErrorTextId`, `ScriptName`, `Comment`) VALUES (18, 32627, 60968, 0, 0, 31, 0, 4, 0, 0, 0, 0, 0, '', 'Require player for spellclick');
INSERT INTO `conditions` (`SourceTypeOrReferenceId`, `SourceGroup`, `SourceEntry`, `SourceId`, `ElseGroup`, `ConditionTypeOrReference`, `ConditionTarget`, `ConditionValue1`, `ConditionValue2`, `ConditionValue3`, `NegativeCondition`, `ErrorType`, `ErrorTextId`, `ScriptName`, `Comment`) VALUES (18, 32627, 46598, 0, 0, 31, 0, 3, 0, 0, 0, 0, 0, '', 'Require unit for spellclick');


DELETE FROM gameobject_template WHERE entry IN(192829);
INSERT INTO `gameobject_template` (`entry`, `type`, `displayId`, `name`, `IconName`, `castBarCaption`, `unk1`, `faction`, `flags`, `size`, `questItem1`, `questItem2`, `questItem3`, `questItem4`, `questItem5`, `questItem6`, `data0`, `data1`, `data2`, `data3`, `data4`, `data5`, `data6`, `data7`, `data8`, `data9`, `data10`, `data11`, `data12`, `data13`, `data14`, `data15`, `data16`, `data17`, `data18`, `data19`, `data20`, `data21`, `data22`, `data23`, `AIName`, `ScriptName`, `VerifiedBuild`) VALUES (192829, 10, 7967, 'Titan Relic', '', 'Activating', '', 0, 0, 0.7, 0, 0, 0, 0, 0, 0, 1634, 0, 22097, 3000, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 27700, 0, 0, 0, 0, 0, 0, 0, 0, 0, '', '', 12340);


UPDATE `gameobject_template` SET `flags`=32 WHERE `entry`=192834; -- Titan Relic
UPDATE `gameobject_template` SET `flags`=32 WHERE `entry`=194083; -- Titan Relic
UPDATE `gameobject_template` SET `flags`=32 WHERE `entry`=194082; -- Titan Relic



-- Delete from DB the double spawns.

DELETE FROM creature WHERE id IN(31036, 31091, 31151, 30739, 32296, 39173, 31101, 31107, 31109, 31051, 30740, 32294, 39172, 31153, 31052, 31108, 31054, 31102, 31106, 31053);



-- Immune 
DELETE FROM `spell_linked_spell` WHERE `spell_trigger` = 58729;
INSERT INTO `spell_linked_spell` (`spell_trigger`, `spell_effect`, `type`, `comment`) VALUES
('58729', '-33786', '2', 'Spiritual immunity should be immune to cyclon');


UPDATE `world`.`creature_template` SET `RegenHealth`=0 WHERE  `entry`=28366;



-- Wintergrasp Siege Turret faction correction.

UPDATE creature_template SET faction=1732 WHERE entry=28319;